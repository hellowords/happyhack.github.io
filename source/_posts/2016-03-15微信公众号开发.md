---
title: 微信公众号开发小记
tags:
  - 微信
id: 131
categories:
  - 干货
date: 2016-03-15 16:35:53
updated: 2016-10-23 03:41:47
---

好久没有更新博客了，最近算是很忙吧，因为要开发一个微信的公众号，需要与微信提供的一些接口来做一些功能，所以在做微信公众号的这个过程中，又去巩固了PHP这门语言。

这里写下我最近所学到的一些知识吧：

首先微信公众号的开发有很多开源的框架，weiphp，douchat，uctoo，Lanewechat等，前两个用的人比较多，我刚开始接触的就是weiphp，感觉用weiphp框架或者douchat框架来开发微信公众号是比较容易上手的，前提是你了解PHP和Thinkphp。但是公司服务器上使用者两种框架的时候老是有问题，访问超级慢，其他网站都没有影响，唯独这两个网站在安装之后访问超级慢，php的配置与nginx的配置从新更改之后还是很慢，于是我不能不使用Lanewechat，来开发微信公众号。（换环境，我还是乐意用weiphp，douchat框架来开发的）

开发微信过程中的注意事项：

accesstoken，这是一个通过微信公众号的appID与密钥返回的一个东东，用来主动给用户发送消息等高级操作时候需要的，这些微信提供的接口都是需要accesstoken授权的，当然了，这个在weiphp与douchat中是不需要担心的，框架本身都做好了处理accesstoken的类，用来处理与验证。

在使用LaneWeChat中，在入口文件wecha.php中，有详细的注释解释第一次该如何在微信后台配置服务器接口。

这里我主要讲一下器程，当我们使用微信发送信息，或进行一些操作的时候，微信会将信息已json的形式转发到我们设置的入口文件，入口文件收到这一信息之后在进行相应的反应.。可以根据您run()这一个方法进行一步步的查看，先判断发过来的是文本还是图片等，或者是不是点击菜单等，这些操作在core/wechatrequest.lib.php进行处理，我在开发微信过程中大部分都基于这个类进行开发的。

举个茄子：

用户点击菜单（扫码推事件）后台会根据switchType()这一类进行相应的调用 evenScancodeWaitMsg这个方法。如果有多个扫码推事件的菜单，则是在到 evenScancodeWaitMsg在根据菜单的关键词(eventkey)在进行分发。eventkey则是在自定义菜单的时候的code所设置的参数；
示例代码：
```
 public static function eventScancodeWaitMsg(&$request){
        //获取该分类的信息
        $eventkey = $request['eventkey'];
        $res = (array)($request['scancodeinfo']);
        $fromuser = $request['fromusername'];
        switch ($eventkey){
					case 'key_12':
						$content ='你好，你扫描的二维码信息为'.$res;
            break;
					case 'key_20':
						$content = 'hello'.$request['eventkey'];
						break;
					default:
						$content = '未知的eventkey:'.$request['eventkey'];
				}

        return ResponsePassive::text($request['fromusername'], $request['tousername'], $content);
}
```